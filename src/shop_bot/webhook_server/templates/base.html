<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{% block title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–æ—Ç–æ–º{% endblock %}</title>
		<link
			rel="stylesheet"
			href="{{ url_for('static', filename='css/style.css') }}"
		/>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	</head>
	<body>
		<div class="container">
			<header class="main-header">
				<nav class="navigation">
					<a
						href="{{ url_for('dashboard_page') }}"
						class="nav-link {% if request.endpoint == 'dashboard_page' %}active{% endif %}"
						>–ì–ª–∞–≤–Ω–∞—è</a
					>
					<a
						href="{{ url_for('users_page') }}"
						class="nav-link {% if request.endpoint == 'users_page' %}active{% endif %}"
						>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a
					>
					<a
						href="{{ url_for('settings_page') }}"
						class="nav-link {% if request.endpoint == 'settings_page' %}active{% endif %}"
						>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a
					>
					<a
						href="https://github.com/r0re/3xShop-bot"
						class="nav-link"
						target="_blank"
						>–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É</a
					>
				</nav>

				<div class="header-controls">
					<!-- Theme Switcher -->
					<div class="theme-switcher">
						<button id="themeToggle" class="button button-text button-small" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
							<span id="themeIcon">üåô</span>
						</button>
					</div>
					<div class="bot-control">
						{% if bot_status.is_running %}
						<p class="status-running">–°—Ç–∞—Ç—É—Å: <strong>–ó–∞–ø—É—â–µ–Ω</strong></p>
						<form action="{{ url_for('stop_bot_route') }}" method="post">
							<button type="submit" class="button button-stop button-small">
								–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
							</button>
						</form>
						{% else %}
						<p class="status-stopped">–°—Ç–∞—Ç—É—Å: <strong>–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</strong></p>
						{% if all_settings_ok %}
						<form action="{{ url_for('start_bot_route') }}" method="post">
							<button type="submit" class="button button-start button-small">
								–ó–∞–ø—É—Å—Ç–∏—Ç—å
							</button>
						</form>
						{% else %}
						<button class="button button-disabled button-small" disabled>
							–ó–∞–ø—É—Å—Ç–∏—Ç—å
						</button>
						{% endif %} {% endif %}
					</div>

					<div class="user-session-controls">
						<span>–í—ã –≤–æ—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É.</span>
						<form
							action="{{ url_for('logout_page') }}"
							method="post"
							style="display: inline"
						>
							<button type="submit" class="button button-logout">–í—ã–π—Ç–∏</button>
						</form>
					</div>
				</div>
			</header>

			{% with messages = get_flashed_messages(with_categories=true) %} {% if
			messages %} {% for category, message in messages %}
			<div class="flash flash-{{ category }}">{{ message }}</div>
			{% endfor %} {% endif %} {% endwith %}

			<main>{% block content %}{% endblock %}</main>
		</div>

		<footer class="main-footer"></footer>
		
		<!-- Theme Switcher Script -->
		<script>
			// Theme management
			const themeToggle = document.getElementById('themeToggle');
			const themeIcon = document.getElementById('themeIcon');
			const body = document.body;

			// Get saved theme or default to light
			const currentTheme = localStorage.getItem('theme') || 'light';
			
			// Apply theme on load
			if (currentTheme === 'dark') {
				body.setAttribute('data-theme', 'dark');
				themeIcon.textContent = '‚òÄÔ∏è';
			} else {
				body.removeAttribute('data-theme');
				themeIcon.textContent = 'üåô';
			}

			// Theme toggle handler
			themeToggle.addEventListener('click', () => {
				const isDark = body.getAttribute('data-theme') === 'dark';
				
				if (isDark) {
					body.removeAttribute('data-theme');
					themeIcon.textContent = 'üåô';
					localStorage.setItem('theme', 'light');
				} else {
					body.setAttribute('data-theme', 'dark');
					themeIcon.textContent = '‚òÄÔ∏è';
					localStorage.setItem('theme', 'dark');
				}
			});

			// Auto-detect system theme preference (optional)
			if (!localStorage.getItem('theme')) {
				const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
				if (prefersDark) {
					body.setAttribute('data-theme', 'dark');
					themeIcon.textContent = '‚òÄÔ∏è';
					localStorage.setItem('theme', 'dark');
				}
			}

			// Listen for system theme changes
			window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
				if (!localStorage.getItem('theme')) {
					if (e.matches) {
						body.setAttribute('data-theme', 'dark');
						themeIcon.textContent = '‚òÄÔ∏è';
					} else {
						body.removeAttribute('data-theme');
						themeIcon.textContent = 'üåô';
					}
				}
			});
		</script>
		
		<script src="{{ url_for('static', filename='js/script.js') }}"></script>
	</body>
</html>
